<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>BMP Creator</title>
        <style type="text/css">
        * {
            font-family: Courier;
        }

        body {
            margin: 5px;
            font-size: 10px;
        }

        #tableBmpCanvas1, #tableBmpCanvas2 {
            border-collapse: collapse;
            display: inline-block;
            margin-right: 10px; 
        }

        #tableBmpCanvas1 td, #tableBmpCanvas2 td {
            border: 1px solid #000000;
            font-size: 8px;
            height: 10px;
            width: 10px;
            text-align: center;
            cursor: pointer;
        }
        #txtBmpCode1, #txtBmpCode2 {
            margin-right: 10px;
        }
        </style>

        <script src="jquery-3.3.1.min.js"></script>

        <script type="text/javascript">
        var canvasCreated = false;
        var canvasCount =3
        var bmpWidth = 10;
        var bmpHeight = 6;
        var pixelMapArray = [];
        var pixelMapArrayCont = [];

        $(document).ready(function() {
            $("#txtBmpWidth").val(bmpWidth);
            $("#txtBmpHeight").val(bmpHeight);

            $("#btnCreateCanvas").on("click", function() {
                if (canvasCreated) {
                    if (!confirm("Canvas already created. Do you want to clear the canvas and create new?")) {
                        return;
                    } else {
                        clearCanvas();
                    }
                }

                bmpWidth = $("#txtBmpWidth").val().trim() || 0;
                bmpHeight = $("#txtBmpHeight").val().trim() || 0;

                if (bmpWidth == 0 || bmpHeight == 0 || !$.isNumeric(bmpWidth) || !$.isNumeric(bmpHeight)) {
                    alert("Width/Height must be numeric and greater than zero!")
                } else {
                    createCanvas(bmpWidth, bmpHeight);
                    canvasCreated = true;
                    initPixelMapArray(bmpWidth, bmpHeight);
                    $("#txtBmpCode1").prop("cols", parseInt(bmpWidth) + 5).prop("rows", parseInt(bmpHeight) + 2);
                    $("#txtBmpCode2").prop("cols", parseInt(bmpWidth) + 5).prop("rows", parseInt(bmpHeight) + 2);
                    showBinaryCode('tableBmpCanvas1', 'txtBmpCode1');
                    showBinaryCode('tableBmpCanvas2', 'txtBmpCode2');
                }
            }); // end btnCreateCanvas click

            $("#btnClearCanvas").on("click", function() {
                if (canvasCreated) {
                    if (confirm("Are you sure to clear the canvas?")) {
                        clearCanvas();
                    }
                } else {
                    alert("No Canvas found");
                }
            }); // end event btnClearCanvas click


            $( "#btnCreateCanvas" ).trigger( "click" );

        }); // end function document is ready

        function initPixelMapArray(bmpWidth, bmpHeight) {
            pixelMapArray = new Array(bmpHeight);
            for (var i = 0; i < bmpHeight; i++) {
                pixelMapArray[i] = new Array(bmpWidth);
                for (j = 0; j < bmpWidth; j++) {
                    pixelMapArray[i][j] = 0;
                }
            }
            pixelMapArrayCont[0] = pixelMapArray;
            pixelMapArrayCont[1] = pixelMapArray;
            pixelMapArrayCont[2] = pixelMapArray;

        }; // end function initPixelMapArray

        function updatePixelMapArray(tableId, pixelCellClass) {
            var arr = pixelCellClass.split("-");
            var y = arr[1];
            var x = arr[2];
            var tid = parseInt(tableId.split("Canvas")[1])-1;;


            //update pixel map
            pixelMapArrayCont[tid][x][y] = pixelMapArrayCont[tid][x][y] == 1 ? 0 : 1;

            // flip pixel color
            if (pixelMapArrayCont[tid][x][y])
                $("#" + tableId + " ." + pixelCellClass).css('background-color', '#000000');
            else
                $("#" + tableId + " ." + pixelCellClass).css('background-color', '#ffffff');

        }; // end function updatePixelMapArray

        function showBinaryCode(tableId,textAreaId) {
            txtArea = $("#" + textAreaId);
            var tid = parseInt(tableId.split("Canvas")[1])-1;

            var rowBinCode = "";
            var binCodeMatrix = "";
            for (x = 0; x < bmpHeight; x++) {
                for (y = 0; y < bmpWidth; y++) {
                    rowBinCode = rowBinCode + pixelMapArrayCont[tid][x][y]
                }
                if (binCodeMatrix != "") binCodeMatrix += ",\n";
                binCodeMatrix = binCodeMatrix + "0b" + rowBinCode;
                rowBinCode = "";
            }
            txtArea.val(binCodeMatrix);
        }; // end function showBinaryCode

        function createCanvas(width, height) {
            $("#divEditor").append('<table id="tableBmpCanvas1"></table>');
            $("#divEditor").append('<table id="tableBmpCanvas2"></table>');
            populateCanvasPixel(width, height, 'tableBmpCanvas1', 'txtBmpCode1');
            populateCanvasPixel(width, height, 'tableBmpCanvas2', 'txtBmpCode2');

        } // // end function createCanvas


function populateCanvasPixel(width, height, tableId, txtBmpCodeId) {
            for (j = 0; j < height; j++) {
                row = document.getElementById(tableId).insertRow(j);
                for (i = 0; i < width; i++) {
                    var cell = row.insertCell(i);

                    var idn = "pixel-" + i + "-" + j;
                    // cell.id = idn;
                    cell.className = idn;
                    cell.title = idn;
                    cell.bgColor = "#ffffff";

                    var mouseDownReleased = true;

                    $(cell).bind("mousedown", function() {
                        updatePixelMapArray(tableId, this.className);
                        showBinaryCode(tableId, txtBmpCodeId);
                        mouseDownReleased = false;
                    });

                    $(cell).bind("mouseup", function() {
                        mouseDownReleased = true;
                    });

                    $(cell).bind("mouseover", function() {
                        $("#lblPixelUnderCursor").text(this.className);
                        if (!mouseDownReleased) {
                            updatePixelMapArray(tableId, this.className);
                            showBinaryCode(tableId, txtBmpCodeId);
                        }
                    });

                    $(cell).bind("mouseout", function() {
                        $("#lblPixelUnderCursor").text("");
                    });
                } // i width
            } // j height


}


        function clearCanvas() {
            canvasCreated = false;
            pixelMapArrayCont = [
                []
            ];
            pixelMapArrayCont.length = 0;
            $("#tableBmpCanvas1").remove();
            $("#tableBmpCanvas2").remove();
            $("#txtBmpCode1").val("");
            $("#txtBmpCode2").val("");
        }

        </script>
    </head>

    <body>
        <div>
            <label>W:</label>
            <input type="text" id="txtBmpWidth">
            <label>H:</label>
            <input type="text" id="txtBmpHeight">
            <button id="btnCreateCanvas">Create Canvas</button>
            <button id="btnClearCanvas">Clear Canvas</button>
            <button id="btnSaveCanvas">Save Canvas</button>
            <button id="btnLoadCanvas">Load Canvas</button>
            <button id="btnCreateHexArray">Create HEX Array</button>
            <label id="lblPixelUnderCursor">&nbsp</label>
        </div>
        <hr>
        <div id="divEditor"></div>
        <hr>
        <div>
            <textarea id="txtBmpCode1"></textarea>
            <textarea id="txtBmpCode2"></textarea>
        </div>
    </body>

</html>
